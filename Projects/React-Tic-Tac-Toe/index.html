<html>

<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.21.1/babel.min.js"></script>
    <script src="https://unpkg.com/react@16.7.0-alpha.0/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16.7.0-alpha.0/umd/react-dom.development.js"></script>

</head>

<body>
    <div id="root"></div>

    <script type="text/babel">

        function calculateWinner(squares) {
            const lines = [
                [0, 1, 2],
                [3, 4, 5],
                [6, 7, 8],
                [0, 3, 6],
                [1, 4, 7],
                [2, 5, 8],
                [0, 4, 8],
                [2, 4, 6]
            ];
            for (let i = 0; i < lines.length; i++) {
                const [a, b, c] = lines[i];
                if (squares[a] && squares[a] === squares[b] && squares[a] === squares[c]) {
                    return squares[a];
                }
            }
            return null;
        }

        function Game() {

            const [board, setBoard] = React.useState(Array(9).fill(null));
            const winner = calculateWinner(board);
            const [count, setCount] = React.useState(0);
            const [gameCount, setGameCount] = React.useState(0);

            const styles = {
                width: '200px',
                margin: '20px auto',
            };


            var randomNumber = 0;

            React.useEffect(() => {
                if (gameCount % 2 && count == 0) {
                    const boardCopy = [...board];
                    randomNumber = Math.floor(Math.random() * 8) + 0;
                    boardCopy[randomNumber] = 'O';
                    setBoard(boardCopy);
                    setCount(count + 1);
                }
            });


            const handleClick = i => {

                
                setCount(count + 1);
                const boardCopy = [...board];
                
                // If user click an occupied square or if game is won, return
                if (winner || boardCopy[i]) {
                    if (winner) setCount(0);

                    return;
                }

                var randomNubmerNotFound = true;

                if ((gameCount % 2 && count < 5) || (gameCount % 2 == 0 && count < 4)) {
                    while (randomNubmerNotFound) {

                        randomNumber = Math.floor(Math.random() * 8) + 0;

                        randomNubmerNotFound = !boardCopy[randomNumber] && randomNumber != i ? false : true;
                    }

                    boardCopy[randomNumber] = 'O';
                }

                boardCopy[i] = 'X';
                setBoard(boardCopy);
            }

            const renderMoves = () => (
                <button onClick={() => { setCount(0); setBoard(Array(9).fill(null)); setGameCount(gameCount + 1); }}>
                    Start Game
                </button>
            )

            return (
                <div>
                    <Board squares={board} onClick={handleClick} />
                    <div style={styles}>
                        <p>{winner ? 'Winner: ' + winner : ''}</p>
                        <p>{winner == null && ((gameCount % 2 && count == 5) || (gameCount % 2 == 0 && count == 4)) ? 'It\'s a draw!' : ''}</p>
                        {renderMoves()}
                    </div>
                </div>
            )
        }

        function Board({ squares, onClick }) {

            const style = {
                border: '4px solid darkblue',
                borderRadius: '10px',
                width: '250px',
                height: '250px',
                margin: '0 auto',
                display: 'grid',
                gridTemplate: 'repeat(3, 1fr) / repeat(3, 1fr)'
            };

            return (
                <div style={style}>
                    {squares.map((square, i) => (
                        <Square key={i} value={square} onClick={() => onClick(i)} />
                    ))}
                </div>
            )
        }

        function Square({ value, onClick }) {

            const style = {
                background: 'lightblue',
                border: '2px solid darkblue',
                fontSize: '30px',
                fontWeight: '800',
                cursor: 'pointer',
                outline: 'none'
            };

            return (
                <button style={style} onClick={onClick}>
                    {value}
                </button>
            )
        }

        function App() {

            return (
                <div>
                    <Game />
                </div>

            )
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>

</html>